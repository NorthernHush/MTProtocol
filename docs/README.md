
## Next Steps

1. Review the generated code
2. Customize the protocol parameters
3. Add your application logic
4. Compile and test the server
5. Deploy to your mesh nodes

---
*Generated by Mesh Proto - Advanced Mesh Networking Toolkit*
'''
            with open(os.path.join(project_path, "README.md"), 'w') as f:
                f.write(readme_content)
            
            self._print_success(f"Standalone {language.upper()} project created successfully!")
            self._print_info(f"Project location: {project_path}")
            self._print_info(f"Main server file: {main_file}")
            self._print_info(f"Protocol header: {header_file}")
            
            # Show next steps
            print(f"\n{Fore.CYAN}ðŸš€ Next Steps:{Style.RESET_ALL}")
            print(f"{Fore.YELLOW}1. Navigate to project: {Fore.WHITE}cd {project_path}")
            if language == "c":
                print(f"{Fore.YELLOW}2. Build project: {Fore.WHITE}make")
                print(f"{Fore.YELLOW}3. Run server: {Fore.WHITE}./mesh_ratchet_server")
            else:
                print(f"{Fore.YELLOW}2. Build project: {Fore.WHITE}mkdir build && cd build && cmake .. && make")
                print(f"{Fore.YELLOW}3. Run server: {Fore.WHITE}./mesh_ratchet_server")
            
            return True
            
        except Exception as e:
            self._print_error(f"Project creation failed: {e}")
            return False
    
    def _generate_protocol_header(self, language: str) -> str:
        """Generate protocol header file."""
        if language == "c":
            return '''
#ifndef MESH_RATCHET_H
#define MESH_RATCHET_H

#include <stdint.h>
#include <stddef.h>

#define MESH_PROTOCOL_VERSION "MeshRachet-1.0"
#define MAX_NODES 32
#define MESSAGE_BUFFER_SIZE 1024

typedef struct {
    uint32_t node_id;
    char address[16];
    uint16_t port;
    uint8_t public_key[32];
} mesh_node_t;

// Protocol initialization
void mesh_ratchet_init(void);
int mesh_add_node(const char* address, uint16_t port);
void mesh_send_message(uint32_t node_id, const char* message);
void mesh_start_server(void);

#endif // MESH_RATCHET_H
'''
        else:
            return '''
#ifndef MESH_RATCHET_HPP
#define MESH_RATCHET_HPP

#include <cstdint>
#include <string>
#include <vector>

class MeshNode {
public:
    MeshNode(uint32_t id, const std::string& address, uint16_t port);
    uint32_t getId() const;
    std::string getAddress() const;
    uint16_t getPort() const;
    
private:
    uint32_t id_;
    std::string address_;
    uint16_t port_;
    std::vector<uint8_t> public_key_;
};

class MeshRachetProtocol {
public:
    MeshRachetProtocol();
    std::vector<uint8_t> encryptMessage(const std::string& message);
    std::string decryptMessage(const std::vector<uint8_t>& encrypted);
    
private:
    std::vector<uint8_t> session_key_;
    std::vector<uint8_t> ratchet_state_;
};

class MeshNetwork {
public:
    MeshNetwork();
    uint32_t addNode(const std::string& address, uint16_t port);
    void sendMessage(uint32_t node_id, const std::string& message);
    void startServer();
    void run();
    
private:
    std::vector<MeshNode> nodes_;
    std::unique_ptr<MeshRachetProtocol> protocol_;
    uint32_t next_node_id_;
};

#endif // MESH_RATCHET_HPP
'''
    
    def list_installations(self):
        """List all MeshRachet protocol installations."""
        self._print_info("MeshRachet Protocol Installations:")
        
        if not self.config.get('installations'):
            self._print_info("No installations found.")
            return
        
        for install_id, install_data in self.config['installations'].items():
            print(f"\n{Fore.GREEN}ðŸ“¦ Installation: {install_id}{Style.RESET_ALL}")
            print(f"   {Fore.CYAN}Path: {install_data['path']}")
            print(f"   {Fore.CYAN}Language: {install_data['language'].upper()}")
            print(f"   {Fore.CYAN}Version: {install_data['version']}")
            print(f"   {Fore.CYAN}Installed: {install_data['installed_at']}")
    
    def system_info(self):
        """Display system information and capabilities."""
        self._print_info("Mesh Proto System Information:")
        
        info_items = [
            ("Tool Version", self.config.get('version', '1.0.0')),
            ("Config Path", self.config_path),
            ("Total Installations", str(len(self.config.get('installations', {})))),
            ("Preferred Language", self.config.get('language_preference', 'cpp').upper()),
            ("Python Version", sys.version.split()[0]),
            ("Platform", sys.platform)
        ]
        
        for key, value in info_items:
            print(f"   {Fore.YELLOW}{key}: {Fore.WHITE}{value}")

def setup_parser():
    """Set up command line argument parser."""
    parser = argparse.ArgumentParser(
        prog='meshuto.py',
        description=f'{Fore.GREEN}Mesh Proto - Automated MeshRachet Protocol Integration Tool{Style.RESET_ALL}',
        epilog=f'''
{Fore.CYAN}
Examples:
  {Fore.WHITE}meshuto.py install /path/to/your/server
  meshuto.py install /path/to/app --language cpp --version 1.2.0
  meshuto.py create-project ./my_mesh --language c --type advanced
  meshuto.py configure --encryption aes256 --port 8080
  meshuto.py status
  meshuto.py list-installations
  meshuto.py system-info
{Style.RESET_ALL}
        ''',
        formatter_class=argparse.RawDescriptionHelpFormatter
    )
    
    subparsers = parser.add_subparsers(dest='command', help='Command to execute')
    
    # Install command
    install_parser = subparsers.add_parser('install', help='Install MeshRachet protocol')
    install_parser.add_argument('target_path', help='Path to target application or server')
    install_parser.add_argument('--language', '-l', choices=['c', 'cpp'], default='cpp',
                              help='Programming language (default: cpp)')
    install_parser.add_argument('--version', '-v', default='latest', 
                              help='Protocol version to install (default: latest)')
    
    # Create project command
    project_parser = subparsers.add_parser('create-project', help='Create standalone project')
    project_parser.add_argument('project_path', help='Path for the new project')
    project_parser.add_argument('--language', '-l', choices=['c', 'cpp'], default='cpp',
                              help='Programming language (default: cpp)')
    project_parser.add_argument('--type', '-t', choices=['basic', 'advanced', 'minimal'], 
                              default='basic', help='Project type (default: basic)')
    
    # Configure command
    configure_parser = subparsers.add_parser('configure', help='Configure protocol settings')
    configure_parser.add_argument('--encryption', '-e', choices=['aes256', 'chacha20'], 
                                 help='Encryption algorithm')
    configure_parser.add_argument('--port', '-p', type=int, help='Communication port')
    configure_parser.add_argument('--max-hops', '-m', type=int, help='Maximum hop count')
    configure_parser.add_argument('--timeout', '-t', type=int, help='Connection timeout in seconds')
    
    # Status command
    subparsers.add_parser('status', help='Check protocol status')
    
    # List installations command
    subparsers.add_parser('list-installations', help='List all installations')
    
    # System info command
    subparsers.add_parser('system-info', help='Display system information')
    
    # Update command
    update_parser = subparsers.add_parser('update', help='Update protocol version')
    update_parser.add_argument('--version', '-v', default='latest', 
                              help='Version to update to (default: latest)')
    
    return parser

def main():
    """Main entry point for Mesh Proto CLI."""
    parser = setup_parser()
    args = parser.parse_args()
    
    if not args.command:
        parser.print_help()
        return 1
    
    manager = MeshProtoManager()
    
    try:
        if args.command == 'install':
            success = manager.install_protocol(args.target_path, args.version, args.language)
            return 0 if success else 1
            
        elif args.command == 'create-project':
            success = manager.create_standalone_project(args.project_path, args.language, args.type)
            return 0 if success else 1
            
        elif args.command == 'configure':
            config_options = {}
            if args.encryption:
                config_options['encryption'] = args.encryption
            if args.port:
                config_options['port'] = args.port
            if args.max_hops:
                config_options['max_hops'] = args.max_hops
            if args.timeout:
                config_options['timeout'] = args.timeout
                
            if not config_options:
                manager._print_error("No configuration options provided. Use --help for available options.")
                return 1
                
            success = manager.configure_protocol(config_options)
            return 0 if success else 1
            
        elif args.command == 'status':
            status = manager.check_status()
            manager._print_info("MeshRachet Protocol Status:")
            for key, value in status.items():
                print(f"   {Fore.YELLOW}{key.replace('_', ' ').title()}: {Fore.WHITE}{value}")
            return 0
            
        elif args.command == 'list-installations':
            manager.list_installations()
            return 0
            
        elif args.command == 'system-info':
            manager.system_info()
            return 0
            
        elif args.command == 'update':
            success = manager.update_protocol(args.version)
            return 0 if success else 1
            
    except KeyboardInterrupt:
        manager._print_error("Operation cancelled by user")
        return 1
    except Exception as e:
        manager._print_error(f"Unexpected error: {e}")
        return 1

if __name__ == '__main__':
    sys.exit(main())